# v1.5 - Multi-Project Operations

**Status**: Planning
**Target**: v1.5
**Created**: 2025-12-09
**Based on**: file-project-management-optimization.md (Phase 2)

---

## Overview

v1.5 focuses on managing multiple projects efficiently: viewing status across projects, running bulk operations, searching globally, and organizing files/tiers.

---

## Features

### 1. Project Status Dashboard (`pj-status`)

**Priority**: High
**Complexity**: Medium
**Effort**: 1-2 days

Show comprehensive status of all indexed projects.

```bash
pj-status              # All projects
pj-status rpkg         # Only R packages
pj-status --dirty      # Only dirty repos
pj-status --json       # JSON output for scripting
```

**Output:**
```
┌─────────────────────────────────────────────────┐
│ Project Status Dashboard                         │
├─────────────────────────────────────────────────┤
│ R Packages (Active - 6 projects)                │
├─────────────────────────────────────────────────┤
│ rmediation      ✓ clean    v0.3.1   main        │
│ mediationverse  ! dirty    v0.1.0   dev  ⚠ 3    │
│ medrobust       ✓ clean    v0.2.0   main        │
├─────────────────────────────────────────────────┤
│ Quarto Projects (3 projects)                     │
├─────────────────────────────────────────────────┤
│ my-paper        ! dirty    draft    main  ⚠ 2   │
│ website         ✓ clean    v1.0     main        │
└─────────────────────────────────────────────────┘

Summary: 9 projects | 6 clean | 3 dirty | 5 uncommitted files
```

**Implementation:**
- New library: `lib/project-index.sh`
- New command: `commands/pj-status`
- Uses existing `project-detector.sh`

---

### 2. Multi-Project Operations (`pj-run`)

**Priority**: High
**Complexity**: Medium
**Effort**: 1-2 days

Run commands across multiple projects.

```bash
# Run in all R packages
pj-run rpkg git status
pj-run rpkg 'git pull && rdev'

# Filter by tier
pj-run rpkg:active git fetch
pj-run quarto:manuscripts quarto render

# Filter by state
pj-run rpkg --dirty git status        # Only dirty repos
pj-run rpkg --behind git pull         # Only repos behind remote

# Interactive mode
pj-run rpkg:active --interactive rdev
  → Shows fzf multi-select
  → Select which projects
  → Runs with progress
```

**Implementation:**
- New library: `lib/multi-project.sh`
- New command: `commands/pj-run`
- Depends on project index

---

### 3. Project Index System (`pj-index`)

**Priority**: High (dependency for other features)
**Complexity**: Medium
**Effort**: 1 day

Maintain a database of all projects for fast lookup.

```bash
pj-index rebuild         # Rebuild project index
pj-index add <path>      # Add custom project
pj-index remove <name>   # Remove project
pj-index list            # List all indexed projects
pj-index list rpkg       # List by type
pj-index list --tier active  # List by tier
```

**Index format** (`~/.cache/zsh-claude-workflow/project-index.txt`):
```
# name|path|type|tier|last_modified
rmediation|/Users/dt/R-packages/active/rmediation|rpkg|active|2025-12-09
mediationverse|/Users/dt/R-packages/active/mediationverse|rpkg|active|2025-12-08
```

**Scan directories:**
- `~/R-packages/active/`
- `~/R-packages/stable/`
- `~/R-packages/scratch/`
- `~/quarto-projects/`
- `~/projects/research/`

**Implementation:**
- New library: `lib/project-index.sh`
- New command: `commands/pj-index`
- Cache in `~/.cache/zsh-claude-workflow/`

---

### 4. Global Project Search (`pj-search`)

**Priority**: Medium
**Complexity**: Medium
**Effort**: 1-2 days

Search code/docs across all indexed projects.

```bash
pj-search "mediation formula"
pj-search --code "bootstrap"        # Code only
pj-search --docs "tutorial"         # Docs only
pj-search --type rpkg "test"        # R packages only
pj-search --tier active "TODO"      # Active tier only
```

**Output:**
```
Searching 10 projects for "mediation formula"...

rmediation (R Package)
  R/calculate_mediation.R:45
    mediation_formula <- as.formula(...)

mediationverse (R Package)
  README.md:34
    ...uses the standard mediation formula...

[Enter to open, Tab to multi-select]
```

**Implementation:**
- New command: `commands/pj-search`
- Uses ripgrep across indexed projects
- FZF for selection

---

### 5. Tier Management (`tier`)

**Priority**: Medium
**Complexity**: Low
**Effort**: 1 day

Manage project storage tiers.

```bash
tier show <project>           # Show current tier
tier list                     # List all tiers and projects
tier list active              # List projects in tier
tier move <project> <tier>    # Move project to tier
tier stats                    # Show tier statistics
```

**Tiers:**
- `active` - Currently developing (`~/R-packages/active/`)
- `stable` - Production ready (`~/R-packages/stable/` or Google Drive)
- `scratch` - Experiments (`~/R-packages/scratch/`)
- `archive` - Old/deprecated

**Implementation:**
- New command: `commands/tier`
- Uses project index
- Updates index on move

---

### 6. File Organization (`organize`)

**Priority**: Low
**Complexity**: Medium
**Effort**: 2 days

Auto-organize files by rules.

```bash
# In project directory
organize temp      # Remove temp files (.Rhistory, .RData, *.Rcheck)
organize builds    # Move builds to builds/ directory
organize old       # Archive old files (>6 months, not modified)

# In ~/Downloads
organize           # Sort by file type
```

**Rules file** (`~/.config/zsh-claude-workflow/organize-rules.yml`):
```yaml
rules:
  - pattern: "*.pdf"
    destination: "~/Documents/pdfs"
    condition: "in_downloads"

  - pattern: "*.{Rhistory,RData}"
    action: "delete"
    condition: "in_rpkg"
```

**Implementation:**
- New library: `lib/file-organization.sh`
- New command: `commands/organize`
- Config in `config/organize-rules.yml`

---

## New Files

### Libraries
```
lib/
├── project-index.sh      # Project indexing system
└── multi-project.sh      # Bulk operations
```

### Commands
```
commands/
├── pj-index              # Manage project index
├── pj-status             # Project status dashboard
├── pj-run                # Multi-project operations
├── pj-search             # Global project search
├── tier                  # Tier management
└── organize              # File organization
```

### Config/Cache
```
~/.cache/zsh-claude-workflow/
└── project-index.txt     # Project index database

config/
└── organize-rules.yml    # Organization rules (optional)
```

---

## Implementation Order

| Order | Feature | Depends On | Effort |
|-------|---------|------------|--------|
| 1 | `lib/project-index.sh` | - | 0.5 day |
| 2 | `pj-index` command | project-index.sh | 0.5 day |
| 3 | `pj-status` command | pj-index | 1 day |
| 4 | `lib/multi-project.sh` | project-index.sh | 0.5 day |
| 5 | `pj-run` command | multi-project.sh | 1 day |
| 6 | `pj-search` command | pj-index | 1 day |
| 7 | `tier` command | pj-index | 1 day |
| 8 | `organize` command | - | 2 days |

**Total estimated effort**: 7-8 days

---

## Dependencies

**Required (already installed):**
- zsh
- git
- fd (file finding)
- ripgrep (searching)
- fzf (selection)

**Optional:**
- jq (JSON output)
- bat (previews in search)

---

## Success Criteria

- [ ] `pj-status` shows all projects with git status
- [ ] `pj-run rpkg git status` works on all R packages
- [ ] `pj-search "term"` finds matches across projects
- [ ] `tier list` shows projects by storage tier
- [ ] Project index rebuilds in < 5 seconds
- [ ] All commands have `--help` output

---

## Future Enhancements (v1.6+)

- Interactive project picker with fzf
- Auto-rebuild index on directory changes
- Cloud sync status integration
- Project health scores
- Dependency graph visualization

---

**Next Step**: Implement `lib/project-index.sh` and `pj-index` command
