# v1.5 - Multi-Project Operations

**Status**: Planning
**Target**: v1.5
**Created**: 2025-12-09
**Updated**: 2025-12-09 (Lean Scope)
**Based on**: file-project-management-optimization.md (Phase 2)

---

## Overview

v1.5 focuses on managing multiple projects efficiently: viewing status across projects, running bulk operations, and searching globally.

**Scope**: All project types including R packages, Quarto projects, dev-tools (MCP servers, CLI tools, Emacs configs), and research projects.

**Lean Scope (revised 2025-12-09)**: Reduced from 10 to 6 high-value features.

| Feature | Priority | Status |
|---------|----------|--------|
| `pj-index` | High | Planned |
| `pj-status` | High | Planned |
| `pj-run` | High | Planned |
| `pj-search` | Medium | Planned |
| `branch-sync` | Medium | Planned |
| `pj` (jump) | Medium | Planned |

**Deferred**: tier, organize, docs-audit (low value)

---

## Features

### 1. Project Status Dashboard (`pj-status`)

**Priority**: High
**Complexity**: Medium
**Effort**: 1-2 days

Show comprehensive status of all indexed projects.

```bash
pj-status              # All projects
pj-status rpkg         # Only R packages
pj-status --dirty      # Only dirty repos
pj-status --json       # JSON output for scripting
```

**Output:**
```
┌─────────────────────────────────────────────────┐
│ Project Status Dashboard                         │
├─────────────────────────────────────────────────┤
│ R Packages (Active - 6 projects)                │
├─────────────────────────────────────────────────┤
│ rmediation      ✓ clean    v0.3.1   main        │
│ mediationverse  ! dirty    v0.1.0   dev  ⚠ 3    │
│ medrobust       ✓ clean    v0.2.0   main        │
├─────────────────────────────────────────────────┤
│ Dev Tools (7 projects)                           │
├─────────────────────────────────────────────────┤
│ zsh-claude-workflow    ✓ clean   v1.4.1  main   │
│ claude-statistical-research  ! dirty  dev ⚠ 2  │
│ claude-r-dev           ✓ clean   v0.2.0  main   │
│ emacs-r-devkit         ✓ clean   v1.0    main   │
│ homebrew-tap           ✓ clean   -       main   │
│ obsidian-cli-ops       ✓ clean   v0.1    main   │
│ r-package-dev-gemini   ✓ clean   -       main   │
├─────────────────────────────────────────────────┤
│ Quarto Projects (3 projects)                     │
├─────────────────────────────────────────────────┤
│ my-paper        ! dirty    draft    main  ⚠ 2   │
│ website         ✓ clean    v1.0     main        │
└─────────────────────────────────────────────────┘

Summary: 16 projects | 12 clean | 4 dirty | 7 uncommitted files
```

**Implementation:**
- New library: `lib/project-index.sh`
- New command: `commands/pj-status`
- Uses existing `project-detector.sh`

---

### 2. Multi-Project Operations (`pj-run`)

**Priority**: High
**Complexity**: Medium
**Effort**: 1-2 days

Run commands across multiple projects.

```bash
# Run in all R packages
pj-run rpkg git status
pj-run rpkg 'git pull && rdev'

# Run in all dev-tools
pj-run devtools git status
pj-run devtools git pull

# Filter by tier
pj-run rpkg:active git fetch
pj-run quarto:manuscripts quarto render

# Filter by state
pj-run rpkg --dirty git status        # Only dirty repos
pj-run rpkg --behind git pull         # Only repos behind remote
pj-run devtools --dirty git status    # Dirty dev-tools

# Run across ALL projects
pj-run all git fetch                  # Fetch all repos
pj-run all --dirty git status         # All dirty repos

# Interactive mode
pj-run rpkg:active --interactive rdev
  → Shows fzf multi-select
  → Select which projects
  → Runs with progress
```

**Implementation:**
- New library: `lib/multi-project.sh`
- New command: `commands/pj-run`
- Depends on project index

---

### 3. Project Index System (`pj-index`)

**Priority**: High (dependency for other features)
**Complexity**: Medium
**Effort**: 1 day

Maintain a database of all projects for fast lookup.

```bash
pj-index rebuild         # Rebuild project index
pj-index add <path>      # Add custom project
pj-index remove <name>   # Remove project
pj-index list            # List all indexed projects
pj-index list rpkg       # List by type
pj-index list --tier active  # List by tier
```

**Index format** (`~/.cache/zsh-claude-workflow/project-index.txt`):
```
# name|path|type|tier|last_modified
rmediation|/Users/dt/R-packages/active/rmediation|rpkg|active|2025-12-09
mediationverse|/Users/dt/R-packages/active/mediationverse|rpkg|active|2025-12-08
zsh-claude-workflow|/Users/dt/projects/dev-tools/zsh-claude-workflow|devtools|active|2025-12-09
claude-statistical-research|/Users/dt/projects/dev-tools/claude-statistical-research|devtools|active|2025-12-09
```

**Scan directories:**
- `~/R-packages/active/`
- `~/R-packages/stable/`
- `~/R-packages/scratch/`
- `~/projects/dev-tools/` (dev-tools: MCP servers, CLI tools, configs)
- `~/quarto-projects/`
- `~/projects/research/`

**Project types:**
| Type | Detection | Examples |
|------|-----------|----------|
| `rpkg` | Has DESCRIPTION file | rmediation, mediationverse |
| `devtools` | In dev-tools/, has package.json or is zsh/emacs project | zsh-claude-workflow, claude-statistical-research |
| `quarto` | Has _quarto.yml | manuscripts, websites |
| `research` | In research/, has data/ or analysis/ | mediation-planning |
| `mcp` | Has mcp-server/ or is MCP project | claude-statistical-research |

**Implementation:**
- New library: `lib/project-index.sh`
- New command: `commands/pj-index`
- Cache in `~/.cache/zsh-claude-workflow/`

---

### 4. Global Project Search (`pj-search`)

**Priority**: Medium
**Complexity**: Medium
**Effort**: 1-2 days

Search code/docs across all indexed projects.

```bash
pj-search "mediation formula"
pj-search --code "bootstrap"        # Code only
pj-search --docs "tutorial"         # Docs only
pj-search --type rpkg "test"        # R packages only
pj-search --type devtools "MCP"     # Dev-tools only
pj-search --tier active "TODO"      # Active tier only
pj-search "skill"                   # Search all projects
```

**Output:**
```
Searching 16 projects for "skill"...

zsh-claude-workflow (Dev Tool)
  lib/skill-manager.sh:12
    _activate_skill() { ...

  commands/skill-activate:45
    skill_activate "$1"

claude-statistical-research (Dev Tool / MCP)
  mcp-server/src/skills/index.ts:23
    export const skills = { ...

rmediation (R Package)
  .claude/skills/r-package.md:1
    # R Package Development Skill

[Enter to open, Tab to multi-select]
```

**Implementation:**
- New command: `commands/pj-search`
- Uses ripgrep across indexed projects
- FZF for selection

---

### 5. Tier Management (`tier`)

**Priority**: Medium
**Complexity**: Low
**Effort**: 1 day

Manage project storage tiers.

```bash
tier show <project>           # Show current tier
tier list                     # List all tiers and projects
tier list active              # List projects in tier
tier move <project> <tier>    # Move project to tier
tier stats                    # Show tier statistics
```

**Tiers:**
- `active` - Currently developing
  - R packages: `~/R-packages/active/`
  - Dev-tools: `~/projects/dev-tools/` (all are active by default)
- `stable` - Production ready (`~/R-packages/stable/` or Google Drive)
- `scratch` - Experiments (`~/R-packages/scratch/`)
- `archive` - Old/deprecated

**Note:** Dev-tools projects are typically always "active" since they're ongoing tools.

**Implementation:**
- New command: `commands/tier`
- Uses project index
- Updates index on move

---

### 6. File Organization (`organize`)

**Priority**: Low
**Complexity**: Medium
**Effort**: 2 days

Auto-organize files by rules.

```bash
# In project directory
organize temp      # Remove temp files (.Rhistory, .RData, *.Rcheck)
organize builds    # Move builds to builds/ directory
organize old       # Archive old files (>6 months, not modified)

# In ~/Downloads
organize           # Sort by file type
```

**Rules file** (`~/.config/zsh-claude-workflow/organize-rules.yml`):
```yaml
rules:
  - pattern: "*.pdf"
    destination: "~/Documents/pdfs"
    condition: "in_downloads"

  - pattern: "*.{Rhistory,RData}"
    action: "delete"
    condition: "in_rpkg"
```

**Implementation:**
- New library: `lib/file-organization.sh`
- New command: `commands/organize`
- Config in `config/organize-rules.yml`

---

## New Files

### Libraries
```
lib/
├── project-index.sh      # Project indexing system
└── multi-project.sh      # Bulk operations
```

### Commands
```
commands/
├── pj-index              # Manage project index
├── pj-status             # Project status dashboard
├── pj-run                # Multi-project operations
├── pj-search             # Global project search
├── tier                  # Tier management
└── organize              # File organization
```

### Config/Cache
```
~/.cache/zsh-claude-workflow/
└── project-index.txt     # Project index database

config/
└── organize-rules.yml    # Organization rules (optional)
```

---

## Implementation Order

| Order | Feature | Depends On | Effort |
|-------|---------|------------|--------|
| 1 | `lib/project-index.sh` | - | 0.5 day |
| 2 | `pj-index` command | project-index.sh | 0.5 day |
| 3 | `pj-status` command | pj-index | 1 day |
| 4 | `lib/multi-project.sh` | project-index.sh | 0.5 day |
| 5 | `pj-run` command | multi-project.sh | 1 day |
| 6 | `pj-search` command | pj-index | 1 day |
| 7 | `tier` command | pj-index | 1 day |
| 8 | `organize` command | - | 2 days |

**Total estimated effort**: 7-8 days

---

## Dependencies

**Required (already installed):**
- zsh
- git
- fd (file finding)
- ripgrep (searching)
- fzf (selection)

**Optional:**
- jq (JSON output)
- bat (previews in search)

---

## Success Criteria

- [ ] `pj-status` shows all projects with git status (R packages + dev-tools + quarto)
- [ ] `pj-run rpkg git status` works on all R packages
- [ ] `pj-run devtools git status` works on all dev-tools
- [ ] `pj-run all --dirty git status` shows all dirty repos
- [ ] `pj-search "term"` finds matches across all project types
- [ ] `tier list` shows projects by storage tier
- [ ] Project index includes ~16+ projects from all directories
- [ ] Project index rebuilds in < 5 seconds
- [ ] All commands have `--help` output

---

## Future Enhancements (v1.6+)

- Interactive project picker with fzf
- Auto-rebuild index on directory changes
- Cloud sync status integration
- Project health scores
- Dependency graph visualization

---

---

## New in v1.5: Utility Commands

Based on workflow analysis (2025-12-09), added utility commands for common friction points.

### 7. Branch Sync (`branch-sync`)

**Priority**: Medium
**Effort**: 0.5 days

Sync branches after merging PRs.

```bash
branch-sync              # Sync dev with main (default)
branch-sync main dev     # Explicit: sync main to dev
branch-sync --pull       # Pull both branches first
```

**Implementation:**
```bash
branch-sync() {
    local target="${1:-dev}"
    local source="${2:-main}"

    git checkout "$source" && git pull
    git checkout "$target" && git merge "$source"
    git push origin "$target"
}
```

---

### 8. Documentation Audit (`docs-audit`)

**Priority**: Medium
**Effort**: 0.5 days

Check documentation coverage for commands.

```bash
docs-audit                    # Audit all command docs
docs-audit --examples         # Check example coverage
docs-audit --fix              # Show what needs examples
```

**Output:**
```
Documentation Audit
───────────────────
Commands with complete examples: 13/34 (38%)

Missing examples:
- /research/cite
- /research/hypothesis
- /teach/feedback
...
```

---

## Tracking

Progress is tracked in `plans/tracking/v1.5-progress.yml`.

Use `plan-status v1.5` to view progress.

---

**Next Step**: Implement `lib/project-index.sh` and `pj-index` command
